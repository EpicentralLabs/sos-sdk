/**
 * This code was AUTOGENERATED using the Codama library.
 * Please DO NOT EDIT THIS FILE, instead use visitors
 * to add features, then rerun Codama to update it.
 *
 * @see https://github.com/codama-idl/codama
 */

import {
  combineCodec,
  fixDecoderSize,
  fixEncoderSize,
  getAddressEncoder,
  getBytesDecoder,
  getBytesEncoder,
  getProgramDerivedAddress,
  getStructDecoder,
  getStructEncoder,
  transformEncoder,
  type AccountMeta,
  type AccountSignerMeta,
  type Address,
  type FixedSizeCodec,
  type FixedSizeDecoder,
  type FixedSizeEncoder,
  type Instruction,
  type InstructionWithAccounts,
  type InstructionWithData,
  type ReadonlyAccount,
  type ReadonlyUint8Array,
  type TransactionSigner,
  type WritableAccount,
  type WritableSignerAccount,
} from "@solana/kit";
import { OPTION_PROGRAM_PROGRAM_ADDRESS } from "../programs";
import {
  expectAddress,
  getAccountMetaFactory,
  type ResolvedAccount,
} from "../shared";

export const LIQUIDATE_WRITER_POSITION_DISCRIMINATOR = new Uint8Array([
  184, 117, 16, 217, 120, 32, 16, 63,
]);

export function getLiquidateWriterPositionDiscriminatorBytes() {
  return fixEncoderSize(getBytesEncoder(), 8).encode(
    LIQUIDATE_WRITER_POSITION_DISCRIMINATOR,
  );
}

export type LiquidateWriterPositionInstruction<
  TProgram extends string = typeof OPTION_PROGRAM_PROGRAM_ADDRESS,
  TAccountOptionPool extends string | AccountMeta<string> = string,
  TAccountOptionAccount extends string | AccountMeta<string> = string,
  TAccountCollateralPool extends string | AccountMeta<string> = string,
  TAccountWriterPosition extends string | AccountMeta<string> = string,
  TAccountOmlpVault extends string | AccountMeta<string> = string,
  TAccountUnderlyingMint extends string | AccountMeta<string> = string,
  TAccountMarketData extends string | AccountMeta<string> = string,
  TAccountPriceUpdate extends string | AccountMeta<string> = string,
  TAccountCollateralVault extends string | AccountMeta<string> = string,
  TAccountOmlpVaultTokenAccount extends string | AccountMeta<string> = string,
  TAccountFeeWallet extends string | AccountMeta<string> = string,
  TAccountLiquidator extends string | AccountMeta<string> = string,
  TAccountTokenProgram extends string | AccountMeta<string> =
    "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA",
  TAccountSystemProgram extends string | AccountMeta<string> =
    "11111111111111111111111111111111",
  TRemainingAccounts extends readonly AccountMeta<string>[] = [],
> = Instruction<TProgram> &
  InstructionWithData<ReadonlyUint8Array> &
  InstructionWithAccounts<
    [
      TAccountOptionPool extends string
        ? WritableAccount<TAccountOptionPool>
        : TAccountOptionPool,
      TAccountOptionAccount extends string
        ? WritableAccount<TAccountOptionAccount>
        : TAccountOptionAccount,
      TAccountCollateralPool extends string
        ? WritableAccount<TAccountCollateralPool>
        : TAccountCollateralPool,
      TAccountWriterPosition extends string
        ? WritableAccount<TAccountWriterPosition>
        : TAccountWriterPosition,
      TAccountOmlpVault extends string
        ? WritableAccount<TAccountOmlpVault>
        : TAccountOmlpVault,
      TAccountUnderlyingMint extends string
        ? ReadonlyAccount<TAccountUnderlyingMint>
        : TAccountUnderlyingMint,
      TAccountMarketData extends string
        ? ReadonlyAccount<TAccountMarketData>
        : TAccountMarketData,
      TAccountPriceUpdate extends string
        ? ReadonlyAccount<TAccountPriceUpdate>
        : TAccountPriceUpdate,
      TAccountCollateralVault extends string
        ? WritableAccount<TAccountCollateralVault>
        : TAccountCollateralVault,
      TAccountOmlpVaultTokenAccount extends string
        ? WritableAccount<TAccountOmlpVaultTokenAccount>
        : TAccountOmlpVaultTokenAccount,
      TAccountFeeWallet extends string
        ? WritableAccount<TAccountFeeWallet>
        : TAccountFeeWallet,
      TAccountLiquidator extends string
        ? WritableSignerAccount<TAccountLiquidator> &
            AccountSignerMeta<TAccountLiquidator>
        : TAccountLiquidator,
      TAccountTokenProgram extends string
        ? ReadonlyAccount<TAccountTokenProgram>
        : TAccountTokenProgram,
      TAccountSystemProgram extends string
        ? ReadonlyAccount<TAccountSystemProgram>
        : TAccountSystemProgram,
      ...TRemainingAccounts,
    ]
  >;

export type LiquidateWriterPositionInstructionData = {
  discriminator: ReadonlyUint8Array;
};

export type LiquidateWriterPositionInstructionDataArgs = {};

export function getLiquidateWriterPositionInstructionDataEncoder(): FixedSizeEncoder<LiquidateWriterPositionInstructionDataArgs> {
  return transformEncoder(
    getStructEncoder([["discriminator", fixEncoderSize(getBytesEncoder(), 8)]]),
    (value) => ({
      ...value,
      discriminator: LIQUIDATE_WRITER_POSITION_DISCRIMINATOR,
    }),
  );
}

export function getLiquidateWriterPositionInstructionDataDecoder(): FixedSizeDecoder<LiquidateWriterPositionInstructionData> {
  return getStructDecoder([
    ["discriminator", fixDecoderSize(getBytesDecoder(), 8)],
  ]);
}

export function getLiquidateWriterPositionInstructionDataCodec(): FixedSizeCodec<
  LiquidateWriterPositionInstructionDataArgs,
  LiquidateWriterPositionInstructionData
> {
  return combineCodec(
    getLiquidateWriterPositionInstructionDataEncoder(),
    getLiquidateWriterPositionInstructionDataDecoder(),
  );
}

export type LiquidateWriterPositionAsyncInput<
  TAccountOptionPool extends string = string,
  TAccountOptionAccount extends string = string,
  TAccountCollateralPool extends string = string,
  TAccountWriterPosition extends string = string,
  TAccountOmlpVault extends string = string,
  TAccountUnderlyingMint extends string = string,
  TAccountMarketData extends string = string,
  TAccountPriceUpdate extends string = string,
  TAccountCollateralVault extends string = string,
  TAccountOmlpVaultTokenAccount extends string = string,
  TAccountFeeWallet extends string = string,
  TAccountLiquidator extends string = string,
  TAccountTokenProgram extends string = string,
  TAccountSystemProgram extends string = string,
> = {
  /** The option pool */
  optionPool: Address<TAccountOptionPool>;
  /** The option account */
  optionAccount: Address<TAccountOptionAccount>;
  /** Collateral pool */
  collateralPool?: Address<TAccountCollateralPool>;
  /** Writer's position to liquidate */
  writerPosition: Address<TAccountWriterPosition>;
  /** OMLP Vault (for repayment tracking) */
  omlpVault: Address<TAccountOmlpVault>;
  /** Underlying token mint (for decimal handling) */
  underlyingMint: Address<TAccountUnderlyingMint>;
  /** Market data account (provides pyth_feed_id for price check) */
  marketData: Address<TAccountMarketData>;
  /** Pyth price update account for current underlying price */
  priceUpdate: Address<TAccountPriceUpdate>;
  /** Collateral vault (source of repayments) */
  collateralVault: Address<TAccountCollateralVault>;
  /** OMLP vault token account (receives loan repayments) */
  omlpVaultTokenAccount: Address<TAccountOmlpVaultTokenAccount>;
  /** Protocol fee wallet (receives liquidation fees) */
  feeWallet: Address<TAccountFeeWallet>;
  /** Liquidator/keeper (permissionless - anyone can call) */
  liquidator: TransactionSigner<TAccountLiquidator>;
  tokenProgram?: Address<TAccountTokenProgram>;
  systemProgram?: Address<TAccountSystemProgram>;
};

export async function getLiquidateWriterPositionInstructionAsync<
  TAccountOptionPool extends string,
  TAccountOptionAccount extends string,
  TAccountCollateralPool extends string,
  TAccountWriterPosition extends string,
  TAccountOmlpVault extends string,
  TAccountUnderlyingMint extends string,
  TAccountMarketData extends string,
  TAccountPriceUpdate extends string,
  TAccountCollateralVault extends string,
  TAccountOmlpVaultTokenAccount extends string,
  TAccountFeeWallet extends string,
  TAccountLiquidator extends string,
  TAccountTokenProgram extends string,
  TAccountSystemProgram extends string,
  TProgramAddress extends Address = typeof OPTION_PROGRAM_PROGRAM_ADDRESS,
>(
  input: LiquidateWriterPositionAsyncInput<
    TAccountOptionPool,
    TAccountOptionAccount,
    TAccountCollateralPool,
    TAccountWriterPosition,
    TAccountOmlpVault,
    TAccountUnderlyingMint,
    TAccountMarketData,
    TAccountPriceUpdate,
    TAccountCollateralVault,
    TAccountOmlpVaultTokenAccount,
    TAccountFeeWallet,
    TAccountLiquidator,
    TAccountTokenProgram,
    TAccountSystemProgram
  >,
  config?: { programAddress?: TProgramAddress },
): Promise<
  LiquidateWriterPositionInstruction<
    TProgramAddress,
    TAccountOptionPool,
    TAccountOptionAccount,
    TAccountCollateralPool,
    TAccountWriterPosition,
    TAccountOmlpVault,
    TAccountUnderlyingMint,
    TAccountMarketData,
    TAccountPriceUpdate,
    TAccountCollateralVault,
    TAccountOmlpVaultTokenAccount,
    TAccountFeeWallet,
    TAccountLiquidator,
    TAccountTokenProgram,
    TAccountSystemProgram
  >
> {
  // Program address.
  const programAddress =
    config?.programAddress ?? OPTION_PROGRAM_PROGRAM_ADDRESS;

  // Original accounts.
  const originalAccounts = {
    optionPool: { value: input.optionPool ?? null, isWritable: true },
    optionAccount: { value: input.optionAccount ?? null, isWritable: true },
    collateralPool: { value: input.collateralPool ?? null, isWritable: true },
    writerPosition: { value: input.writerPosition ?? null, isWritable: true },
    omlpVault: { value: input.omlpVault ?? null, isWritable: true },
    underlyingMint: { value: input.underlyingMint ?? null, isWritable: false },
    marketData: { value: input.marketData ?? null, isWritable: false },
    priceUpdate: { value: input.priceUpdate ?? null, isWritable: false },
    collateralVault: { value: input.collateralVault ?? null, isWritable: true },
    omlpVaultTokenAccount: {
      value: input.omlpVaultTokenAccount ?? null,
      isWritable: true,
    },
    feeWallet: { value: input.feeWallet ?? null, isWritable: true },
    liquidator: { value: input.liquidator ?? null, isWritable: true },
    tokenProgram: { value: input.tokenProgram ?? null, isWritable: false },
    systemProgram: { value: input.systemProgram ?? null, isWritable: false },
  };
  const accounts = originalAccounts as Record<
    keyof typeof originalAccounts,
    ResolvedAccount
  >;

  // Resolve default values.
  if (!accounts.collateralPool.value) {
    accounts.collateralPool.value = await getProgramDerivedAddress({
      programAddress,
      seeds: [
        getBytesEncoder().encode(
          new Uint8Array([
            99, 111, 108, 108, 97, 116, 101, 114, 97, 108, 95, 112, 111, 111,
            108,
          ]),
        ),
        getAddressEncoder().encode(expectAddress(accounts.optionAccount.value)),
      ],
    });
  }
  if (!accounts.tokenProgram.value) {
    accounts.tokenProgram.value =
      "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA" as Address<"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA">;
  }
  if (!accounts.systemProgram.value) {
    accounts.systemProgram.value =
      "11111111111111111111111111111111" as Address<"11111111111111111111111111111111">;
  }

  const getAccountMeta = getAccountMetaFactory(programAddress, "programId");
  return Object.freeze({
    accounts: [
      getAccountMeta(accounts.optionPool),
      getAccountMeta(accounts.optionAccount),
      getAccountMeta(accounts.collateralPool),
      getAccountMeta(accounts.writerPosition),
      getAccountMeta(accounts.omlpVault),
      getAccountMeta(accounts.underlyingMint),
      getAccountMeta(accounts.marketData),
      getAccountMeta(accounts.priceUpdate),
      getAccountMeta(accounts.collateralVault),
      getAccountMeta(accounts.omlpVaultTokenAccount),
      getAccountMeta(accounts.feeWallet),
      getAccountMeta(accounts.liquidator),
      getAccountMeta(accounts.tokenProgram),
      getAccountMeta(accounts.systemProgram),
    ],
    data: getLiquidateWriterPositionInstructionDataEncoder().encode({}),
    programAddress,
  } as LiquidateWriterPositionInstruction<
    TProgramAddress,
    TAccountOptionPool,
    TAccountOptionAccount,
    TAccountCollateralPool,
    TAccountWriterPosition,
    TAccountOmlpVault,
    TAccountUnderlyingMint,
    TAccountMarketData,
    TAccountPriceUpdate,
    TAccountCollateralVault,
    TAccountOmlpVaultTokenAccount,
    TAccountFeeWallet,
    TAccountLiquidator,
    TAccountTokenProgram,
    TAccountSystemProgram
  >);
}

export type LiquidateWriterPositionInput<
  TAccountOptionPool extends string = string,
  TAccountOptionAccount extends string = string,
  TAccountCollateralPool extends string = string,
  TAccountWriterPosition extends string = string,
  TAccountOmlpVault extends string = string,
  TAccountUnderlyingMint extends string = string,
  TAccountMarketData extends string = string,
  TAccountPriceUpdate extends string = string,
  TAccountCollateralVault extends string = string,
  TAccountOmlpVaultTokenAccount extends string = string,
  TAccountFeeWallet extends string = string,
  TAccountLiquidator extends string = string,
  TAccountTokenProgram extends string = string,
  TAccountSystemProgram extends string = string,
> = {
  /** The option pool */
  optionPool: Address<TAccountOptionPool>;
  /** The option account */
  optionAccount: Address<TAccountOptionAccount>;
  /** Collateral pool */
  collateralPool: Address<TAccountCollateralPool>;
  /** Writer's position to liquidate */
  writerPosition: Address<TAccountWriterPosition>;
  /** OMLP Vault (for repayment tracking) */
  omlpVault: Address<TAccountOmlpVault>;
  /** Underlying token mint (for decimal handling) */
  underlyingMint: Address<TAccountUnderlyingMint>;
  /** Market data account (provides pyth_feed_id for price check) */
  marketData: Address<TAccountMarketData>;
  /** Pyth price update account for current underlying price */
  priceUpdate: Address<TAccountPriceUpdate>;
  /** Collateral vault (source of repayments) */
  collateralVault: Address<TAccountCollateralVault>;
  /** OMLP vault token account (receives loan repayments) */
  omlpVaultTokenAccount: Address<TAccountOmlpVaultTokenAccount>;
  /** Protocol fee wallet (receives liquidation fees) */
  feeWallet: Address<TAccountFeeWallet>;
  /** Liquidator/keeper (permissionless - anyone can call) */
  liquidator: TransactionSigner<TAccountLiquidator>;
  tokenProgram?: Address<TAccountTokenProgram>;
  systemProgram?: Address<TAccountSystemProgram>;
};

export function getLiquidateWriterPositionInstruction<
  TAccountOptionPool extends string,
  TAccountOptionAccount extends string,
  TAccountCollateralPool extends string,
  TAccountWriterPosition extends string,
  TAccountOmlpVault extends string,
  TAccountUnderlyingMint extends string,
  TAccountMarketData extends string,
  TAccountPriceUpdate extends string,
  TAccountCollateralVault extends string,
  TAccountOmlpVaultTokenAccount extends string,
  TAccountFeeWallet extends string,
  TAccountLiquidator extends string,
  TAccountTokenProgram extends string,
  TAccountSystemProgram extends string,
  TProgramAddress extends Address = typeof OPTION_PROGRAM_PROGRAM_ADDRESS,
>(
  input: LiquidateWriterPositionInput<
    TAccountOptionPool,
    TAccountOptionAccount,
    TAccountCollateralPool,
    TAccountWriterPosition,
    TAccountOmlpVault,
    TAccountUnderlyingMint,
    TAccountMarketData,
    TAccountPriceUpdate,
    TAccountCollateralVault,
    TAccountOmlpVaultTokenAccount,
    TAccountFeeWallet,
    TAccountLiquidator,
    TAccountTokenProgram,
    TAccountSystemProgram
  >,
  config?: { programAddress?: TProgramAddress },
): LiquidateWriterPositionInstruction<
  TProgramAddress,
  TAccountOptionPool,
  TAccountOptionAccount,
  TAccountCollateralPool,
  TAccountWriterPosition,
  TAccountOmlpVault,
  TAccountUnderlyingMint,
  TAccountMarketData,
  TAccountPriceUpdate,
  TAccountCollateralVault,
  TAccountOmlpVaultTokenAccount,
  TAccountFeeWallet,
  TAccountLiquidator,
  TAccountTokenProgram,
  TAccountSystemProgram
> {
  // Program address.
  const programAddress =
    config?.programAddress ?? OPTION_PROGRAM_PROGRAM_ADDRESS;

  // Original accounts.
  const originalAccounts = {
    optionPool: { value: input.optionPool ?? null, isWritable: true },
    optionAccount: { value: input.optionAccount ?? null, isWritable: true },
    collateralPool: { value: input.collateralPool ?? null, isWritable: true },
    writerPosition: { value: input.writerPosition ?? null, isWritable: true },
    omlpVault: { value: input.omlpVault ?? null, isWritable: true },
    underlyingMint: { value: input.underlyingMint ?? null, isWritable: false },
    marketData: { value: input.marketData ?? null, isWritable: false },
    priceUpdate: { value: input.priceUpdate ?? null, isWritable: false },
    collateralVault: { value: input.collateralVault ?? null, isWritable: true },
    omlpVaultTokenAccount: {
      value: input.omlpVaultTokenAccount ?? null,
      isWritable: true,
    },
    feeWallet: { value: input.feeWallet ?? null, isWritable: true },
    liquidator: { value: input.liquidator ?? null, isWritable: true },
    tokenProgram: { value: input.tokenProgram ?? null, isWritable: false },
    systemProgram: { value: input.systemProgram ?? null, isWritable: false },
  };
  const accounts = originalAccounts as Record<
    keyof typeof originalAccounts,
    ResolvedAccount
  >;

  // Resolve default values.
  if (!accounts.tokenProgram.value) {
    accounts.tokenProgram.value =
      "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA" as Address<"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA">;
  }
  if (!accounts.systemProgram.value) {
    accounts.systemProgram.value =
      "11111111111111111111111111111111" as Address<"11111111111111111111111111111111">;
  }

  const getAccountMeta = getAccountMetaFactory(programAddress, "programId");
  return Object.freeze({
    accounts: [
      getAccountMeta(accounts.optionPool),
      getAccountMeta(accounts.optionAccount),
      getAccountMeta(accounts.collateralPool),
      getAccountMeta(accounts.writerPosition),
      getAccountMeta(accounts.omlpVault),
      getAccountMeta(accounts.underlyingMint),
      getAccountMeta(accounts.marketData),
      getAccountMeta(accounts.priceUpdate),
      getAccountMeta(accounts.collateralVault),
      getAccountMeta(accounts.omlpVaultTokenAccount),
      getAccountMeta(accounts.feeWallet),
      getAccountMeta(accounts.liquidator),
      getAccountMeta(accounts.tokenProgram),
      getAccountMeta(accounts.systemProgram),
    ],
    data: getLiquidateWriterPositionInstructionDataEncoder().encode({}),
    programAddress,
  } as LiquidateWriterPositionInstruction<
    TProgramAddress,
    TAccountOptionPool,
    TAccountOptionAccount,
    TAccountCollateralPool,
    TAccountWriterPosition,
    TAccountOmlpVault,
    TAccountUnderlyingMint,
    TAccountMarketData,
    TAccountPriceUpdate,
    TAccountCollateralVault,
    TAccountOmlpVaultTokenAccount,
    TAccountFeeWallet,
    TAccountLiquidator,
    TAccountTokenProgram,
    TAccountSystemProgram
  >);
}

export type ParsedLiquidateWriterPositionInstruction<
  TProgram extends string = typeof OPTION_PROGRAM_PROGRAM_ADDRESS,
  TAccountMetas extends readonly AccountMeta[] = readonly AccountMeta[],
> = {
  programAddress: Address<TProgram>;
  accounts: {
    /** The option pool */
    optionPool: TAccountMetas[0];
    /** The option account */
    optionAccount: TAccountMetas[1];
    /** Collateral pool */
    collateralPool: TAccountMetas[2];
    /** Writer's position to liquidate */
    writerPosition: TAccountMetas[3];
    /** OMLP Vault (for repayment tracking) */
    omlpVault: TAccountMetas[4];
    /** Underlying token mint (for decimal handling) */
    underlyingMint: TAccountMetas[5];
    /** Market data account (provides pyth_feed_id for price check) */
    marketData: TAccountMetas[6];
    /** Pyth price update account for current underlying price */
    priceUpdate: TAccountMetas[7];
    /** Collateral vault (source of repayments) */
    collateralVault: TAccountMetas[8];
    /** OMLP vault token account (receives loan repayments) */
    omlpVaultTokenAccount: TAccountMetas[9];
    /** Protocol fee wallet (receives liquidation fees) */
    feeWallet: TAccountMetas[10];
    /** Liquidator/keeper (permissionless - anyone can call) */
    liquidator: TAccountMetas[11];
    tokenProgram: TAccountMetas[12];
    systemProgram: TAccountMetas[13];
  };
  data: LiquidateWriterPositionInstructionData;
};

export function parseLiquidateWriterPositionInstruction<
  TProgram extends string,
  TAccountMetas extends readonly AccountMeta[],
>(
  instruction: Instruction<TProgram> &
    InstructionWithAccounts<TAccountMetas> &
    InstructionWithData<ReadonlyUint8Array>,
): ParsedLiquidateWriterPositionInstruction<TProgram, TAccountMetas> {
  if (instruction.accounts.length < 14) {
    // TODO: Coded error.
    throw new Error("Not enough accounts");
  }
  let accountIndex = 0;
  const getNextAccount = () => {
    const accountMeta = (instruction.accounts as TAccountMetas)[accountIndex]!;
    accountIndex += 1;
    return accountMeta;
  };
  return {
    programAddress: instruction.programAddress,
    accounts: {
      optionPool: getNextAccount(),
      optionAccount: getNextAccount(),
      collateralPool: getNextAccount(),
      writerPosition: getNextAccount(),
      omlpVault: getNextAccount(),
      underlyingMint: getNextAccount(),
      marketData: getNextAccount(),
      priceUpdate: getNextAccount(),
      collateralVault: getNextAccount(),
      omlpVaultTokenAccount: getNextAccount(),
      feeWallet: getNextAccount(),
      liquidator: getNextAccount(),
      tokenProgram: getNextAccount(),
      systemProgram: getNextAccount(),
    },
    data: getLiquidateWriterPositionInstructionDataDecoder().decode(
      instruction.data,
    ),
  };
}
